<!DOCTYPE html>
<html>
<head>
    <title>Job Posting Assistant</title>
    <style>
        body { font-family: Arial, sans-serif; background: #f4f4f4; }
        #chatbox { width: 500px; margin: 20px auto; background: white; padding: 20px; border-radius: 10px; }
        #messages { height: 300px; overflow-y: scroll; border: 1px solid #ccc; padding: 10px; background: #fafafa; }
        .user { color: blue; margin: 5px 0; }
        .bot { color: black; margin: 5px 0; }
        input { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 5px; }
        #jobOutputContainer { width: 500px; margin: 20px auto; background: #fff; padding: 15px; border-radius: 10px; border: 1px solid #ccc; }
    </style>
</head>
<body>
    <!-- Chat container -->
    <div id="chatbox">
        <div id="messages"></div>
        <input type="text" id="message" placeholder="Type your answer and press Enter..." autofocus>
    </div>

    <!-- Job Output container -->
    <div id="jobOutputContainer">
        <h3>Generated Job Ad:</h3>
        <div id="jobOutput" style="white-space: pre-wrap;"></div>
    </div>

    <script>
        const userId = Date.now();
        const messagesDiv = document.getElementById("messages");
        const input = document.getElementById("message");
        const jobOutputDiv = document.getElementById("jobOutput");

        function addMessage(text, sender) {
            const div = document.createElement("div");
            div.className = sender;
            div.innerHTML = sender === "bot" ? text : text.replace(/</g, "&lt;"); 
            messagesDiv.appendChild(div);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        input.addEventListener("keypress", function(e) {
            if (e.key === "Enter" && input.value.trim() !== "") {
                const msg = input.value;
                addMessage(msg, "user");
                input.value = "";

                fetch("/chat", {
                    method: "POST",
                    headers: { "Content-Type": "application/x-www-form-urlencoded" },
                    body: `message=${encodeURIComponent(msg)}&user_id=${userId}`
                })
                .then(res => res.json())
                .then(data => {
                    addMessage(data.reply, "bot");

                    // If job ad is ready, also show it outside chat
                    if (data.done) {
                        jobOutputDiv.textContent = data.reply;
                    }
                });
            }
        });

        // Start conversation automatically
        fetch("/chat", {
            method: "POST",
            headers: { "Content-Type": "application/x-www-form-urlencoded" },
            body: `message=&user_id=${userId}`
        })
        .then(res => res.json())
        .then(data => {
            addMessage(data.reply, "bot");
        });
    </script>
</body>
</html>
